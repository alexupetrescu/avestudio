{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:clients_clientalbum_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; <a href="{% url 'admin:clients_clientalbum_change' album.pk %}">{{ album|truncatewords:"18" }}</a>
&rsaquo; {% translate 'Upload Multiple Images' %}
</div>
{% endblock %}

{% block content %}
<h1>Upload Multiple Images to "{{ album.title }}"</h1>

<div id="content-main">
    <form method="post" enctype="multipart/form-data" id="upload-form">
        {% csrf_token %}
        
        <fieldset class="module aligned">
            <div class="form-row">
                <div>
                    <label for="id_images" style="font-weight: bold; margin-bottom: 10px; display: block;">
                        Select Multiple Images:
                    </label>
                    <input 
                        type="file" 
                        name="images" 
                        id="id_images" 
                        multiple 
                        accept="image/*"
                        style="padding: 10px; border: 2px dashed #ccc; border-radius: 4px; width: 100%; cursor: pointer;"
                        onchange="updateFileList(this.files)"
                    />
                    <p class="help" style="margin-top: 10px; color: #666;">
                        You can select multiple images at once by holding Ctrl (Windows) or Cmd (Mac) while clicking, 
                        or by dragging and dropping files into the input area.
                    </p>
                </div>
            </div>
            
            <div id="file-list" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; display: none;">
                <h3 style="margin-top: 0;">Selected Files:</h3>
                <ul id="file-list-items" style="list-style: none; padding: 0;"></ul>
            </div>
        </fieldset>
        
        <div class="submit-row" style="margin-top: 20px;">
            <input type="submit" value="Upload Images" class="default" style="padding: 10px 20px; font-size: 14px; font-weight: bold;" />
            <a href="{% url 'admin:clients_clientalbum_change' album.pk %}" class="button" style="padding: 10px 20px; margin-left: 10px; text-decoration: none; display: inline-block;">Cancel</a>
        </div>
    </form>
    
    <div style="margin-top: 30px; padding: 15px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 4px;">
        <h3 style="margin-top: 0;">Current Album Images ({{ album.images.count }})</h3>
        {% if album.images.all %}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                {% for image in album.images.all %}
                    <div style="position: relative; border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
                        <img src="{{ image.image.url }}" alt="{{ image.filename }}" style="width: 100%; height: 150px; object-fit: cover; display: block;" />
                        <div style="padding: 8px; background: white; font-size: 11px; color: #666; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;">
                            {{ image.filename }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="color: #666;">No images in this album yet.</p>
        {% endif %}
    </div>
</div>

<script>
function updateFileList(files) {
    const fileListDiv = document.getElementById('file-list');
    const fileListItems = document.getElementById('file-list-items');
    
    if (files.length === 0) {
        fileListDiv.style.display = 'none';
        return;
    }
    
    fileListDiv.style.display = 'block';
    fileListItems.innerHTML = '';
    
    Array.from(files).forEach((file, index) => {
        const li = document.createElement('li');
        li.style.padding = '8px';
        li.style.marginBottom = '5px';
        li.style.background = 'white';
        li.style.borderRadius = '3px';
        li.style.display = 'flex';
        li.style.justifyContent = 'space-between';
        li.style.alignItems = 'center';
        
        const fileInfo = document.createElement('span');
        fileInfo.textContent = `${index + 1}. ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
        fileInfo.style.flex = '1';
        
        li.appendChild(fileInfo);
        fileListItems.appendChild(li);
    });
}

// Add drag and drop functionality
const fileInput = document.getElementById('id_images');
const form = document.getElementById('upload-form');

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    form.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

['dragenter', 'dragover'].forEach(eventName => {
    form.addEventListener(eventName, highlight, false);
});

['dragleave', 'drop'].forEach(eventName => {
    form.addEventListener(eventName, unhighlight, false);
});

function highlight(e) {
    fileInput.style.borderColor = '#2196F3';
    fileInput.style.background = '#e3f2fd';
}

function unhighlight(e) {
    fileInput.style.borderColor = '#ccc';
    fileInput.style.background = '';
}

form.addEventListener('drop', handleDrop, false);

function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    fileInput.files = files;
    updateFileList(files);
}
</script>

<style>
#upload-form {
    max-width: 800px;
}
.form-row {
    margin-bottom: 20px;
}
.help {
    font-size: 12px;
    color: #666;
}
</style>
{% endblock %}

